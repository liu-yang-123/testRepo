<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zcxd.db.mapper.FingerprintMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.zcxd.db.model.Fingerprint">
        <id column="id" property="id" />
        <result column="user_id" property="userId" />
        <result column="user_type" property="userType" />
        <result column="finger_idx" property="fingerIdx" />
        <result column="finger_print" property="fingerPrint" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
    </resultMap>
    
	<select id="findListByPage" resultType="java.util.Map" >
		SELECT
			fp.id,
			e.emp_no AS empNo,
			e.emp_name AS empName,
			ej.name AS jobName,
			fp.user_type AS userType,
			fp.finger_idx AS fingerIdx
		FROM
			fingerprint fp
		INNER JOIN employee e ON fp.user_id = e.id
		INNER JOIN employee_job ej ON e.job_ids = ej.id
		<where>
			<if test="empNo != null and empNo != ''">
				and e.emp_no=#{empNo}
			</if>
			<if test="empName != null and empName != ''">
				and e.emp_name like '%${empName}%'
			</if>
			<if test="jobId != null">
				and e.job_ids = #{jobId}
			</if>			
			<if test="userType != null and userType != ''">
				and fp.user_type = #{userType}
			</if>
			<if test="deleted != null">
                and fp.deleted = #{deleted}
            </if>
		</where>
		order by fp.create_time desc
	</select>

	<select id="getMaxUpdateTime" resultType="java.lang.Long" >
		select max(update_time) from fingerprint where user_type = #{userType}
    </select>
    
    <update id="deleteUserPrint">
    	update fingerprint set deleted = 1,update_time=#{updateTime} where user_id = #{userId} and user_type = #{userType}
	</update>
</mapper>
