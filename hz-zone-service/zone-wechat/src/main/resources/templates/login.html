<!DOCTYPE html>
<html>
  <head>
    <title>账号绑定</title>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />

<meta http-equiv="Pragma" content="no-cache" />

<meta http-equiv="Expires" content="0" />
<meta name="description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">

<link rel="stylesheet" href="lib/weui.min.css">
<link rel="stylesheet" href="css/jquery-weui.css">
<link rel="stylesheet" href="css/demos.css">

  </head>

  <body ontouchstart>


  <header class='demos-header'>
      <h1 class="demos-title">账号绑定</h1>
  </header>

     <form method="get" onsubmit="return checkInfo()" action="loginInfo" >
         <div class="weui-cells weui-cells_form">

             <div class="weui-cell">
                 <div class="weui-cell__hd"><label class="weui-label">工号</label></div>
                 <div class="weui-cell__bd">
                     <input class="weui-input"  id="empNo" name="empNo" type="number" pattern="[0-6]*" placeholder="请输入工号">
                 </div>
             </div>
             <div class="weui-cell">
                 <div class="weui-cell__hd">
                     <label class="weui-label">手机号</label>
                 </div>
                 <div class="weui-cell__bd">
                     <input class="weui-input" id="phone" name="phone" type="tel" placeholder="请输入手机号">
                 </div>

             </div>
         </div>


    <label for="weuiAgree" class="weui-agree">
      <input id="weuiAgree" type="checkbox" class="weui-agree__checkbox">
      <span class="weui-agree__text">
        阅读并同意<a href="javascript:void(0);">《相关条款》</a>
      </span>
    </label>

    <div class="weui-btn-area">
      <button  class="weui-btn weui-btn_primary" href="javascript:" id="showTooltips"  type="submit">确定</button>
    </div>
	<tr><td><input id="userOpenid" type="hidden" name="userOpenid" th:value="${openid}"></input></td></tr>
	<tr><td><input id="smscode" type="hidden" value="" name="smscode"></input></td></tr>
	</form>


<script src="lib/jquery-2.1.4.js"></script>
 <script src="js/jquery-weui.js"></script>
<script src="lib/fastclick.js"></script>
<script>
  $(function() {
    FastClick.attach(document.body);

  });
</script>



    <script>

       function checkInfo(){
            var tel = $('#phone').val();
            var empNo = $('#empNo').val();
            var flag=true;
            $.ajax({
                url : '/sendsms',
                type : 'GET',
                async:false,
                contentType : 'application/json',
                dataType : 'json',
                data : {
                    phone:tel,
                    empNo:empNo
                },
                success : function(data) {
                    if(data.code=="10000" || data.code=="10001")
                    {
                        flag=false;
                        $.alert(data.msg);
                    }


                }
            });
           return flag;
        }
      $("#showTooltips").click(function() {
        var tel = $('#phone').val();
        var empNo = $('#empNo').val();
        var reg_tel = /^(13[0-9]|14[01456879]|15[0-3,5-9]|16[2567]|17[0-8]|18[0-9]|19[0-3,5-9])\d{8}$/;
        if(!empNo){
              $.alert('请输入工号');
              return false;
        } else if(!tel){
        	$.alert('请输入手机号');
        	return false;
        }else if (!reg_tel.test(tel)){
            $.alert('请输入正确的手机号');
            return false;
        }
        // else if(!code || !/\d{6}/.test(code)){
        // 	$.alert('请输入六位手机验证码');
        // 	return false;
        // }
        else if(!(document.getElementById("weuiAgree").checked)){
        	$.alert('请勾选阅读并同意相关条款');
        	return false;
        }


        // else if($('#smscode').val() != code){
        // 	$.alert('验证码错误');
        // 	return false;
        // }
        // else if(tel != telsms)
        // {
        // 	$.alert('手机号与发送短信验证的手机号不匹配');
        // 	return false;
        // }

        else 
        {
            $.alert('提交成功', 'success');

       	}
        
        
      });
      
      $("#sendsms").click(function()
      {
    	  var tel = $('#phone').val();
          var empNo = $('#empNo').val();

          if(!empNo || !/\d{6}/.test(empNo)){
              $.alert('请输入六位工号');
              return false;
          }
    	  //判断手机合法性
    	  if(!tel || !/1[3|4|5|7|8]\d{9}/.test(tel))
   		  {
				$.alert('请输入正确的手机号');
   		  		return;
   		  }
    	  
    	  time();
    	  $.ajax({
    	        url : '/sendsms',
    	        type : 'GET',
    	        contentType : 'application/json',
    	        dataType : 'json',
    	        data : {
    	            phone:tel,
                    empNo:empNo
    	        },
    	        success : function(data) {
    	            //console.info(data);
    	            if(data.result=="2")
    	            {
    	           		console.info("发送成功"+data.code);
    	           		$('#smscode').val(data.code);
    	           		$('#smsphone').val(data.tel);
    	           	}else if(data.code=="10000" || data.code=="10001")
    	           	{
    	           		$.alert(data.msg);
    	           		stopTime();
    	           	}
    	            else
    	           	{
    	           		$.alert('发送验证码失败');
    	           		stopTime();
    	           	}
    	            
    	        }
    	    });
      });
      
      
      var wait=60;//时间
      var t;//计时器
      function time(){
          if (wait == 0) {
              $('#sendsms').removeAttr('disabled');
              //btnObj.removeAttribute("disabled");
              //btnObj.textContent = "再次获取验证码";
              $('#sendsms').text("获取验证码");
              wait = 60;
          }else{
              //btnObj.setAttribute("disabled", true);
              $('#sendsms').attr('disabled','disabled');
              //$('#btnVerify').textContent = "重新发送验证码(" + wait + "s)";
              $('#sendsms').text("重新发送验证码(" + wait + "s)");
              wait--;
              t=setTimeout(function(){
                  time();
              },1000)
          }
      }
      function stopTime(){
    	  $('#sendsms').removeAttr('disabled');
    	  $('#sendsms').text("获取验证码");
          clearTimeout(t);
      }
      
      
    </script>
  </body>
</html>
